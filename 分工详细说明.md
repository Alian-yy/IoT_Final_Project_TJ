# 小嘉智能环境监控系统 - 项目分工详细说明

## 📋 项目概述

**项目名称**: 小嘉智能环境监控系统  
**项目类型**: 基于MQTT的IoT环境数据发布-订阅系统  
**数据类型**: 温度(temperature)、湿度(humidity)、气压(pressure)  
**MQTT主题**: `sensor/temperature`, `sensor/humidity`, `sensor/pressure`

---

## 👥 团队分工表

| 成员 | 职责 | 状态 | 技术栈 | 主要交付物 |
|------|------|------|--------|-----------|
| **A同学** | MQTT服务器部署与配置 | ✅ 已完成 | Mosquitto, Linux, UFW | MQTT Broker服务 |
| **B同学** | 数据发布端开发 | ✅ 已完成 | Vue3, FastAPI, Python | 发布端Web应用 |
| **C同学** | 数据处理与分析 | 🔄 进行中 | Vue3, ECharts, Python | 数据分析与可视化 |
| **D同学** | 数据订阅端开发 | 🔄 进行中 | Vue3, MQTT.js | 订阅端Web应用 |


---

## 🎯 A同学 - MQTT服务器部署（已完成）

### 主要任务
1. ✅ 在服务器上安装并配置 Mosquitto MQTT Broker
2. ✅ 配置防火墙规则，开放1883端口
3. ✅ 确保MQTT服务稳定运行
4. ✅ 提供MQTT Broker连接信息

### 技术栈
- **操作系统**: Linux (Ubuntu/Debian)
- **MQTT Broker**: Mosquitto 2.x
- **防火墙**: UFW
- **服务管理**: systemd

### 交付内容
- ✅ MQTT Broker服务运行在 `192.168.1.10:1883`
- ✅ 服务端配置文档
- ✅ 防火墙配置说明

---

## 🎯 B同学 - 数据发布端开发（已完成）

### 主要任务
1. ✅ 设计并实现发布端Web界面
2. ✅ 实现MQTT连接管理功能
3. ✅ 实现从文件批量发布数据功能
4. ✅ 实现实时发布进度显示
5. ✅ 实现WebSocket实时状态推送

### 技术栈

#### 前端技术
- **框架**: Vue 3 (Composition API)
- **构建工具**: Vite 5.4.21
- **路由**: Vue Router 4
- **HTTP客户端**: Axios
- **实时通信**: WebSocket
- **样式**: CSS3 (深色渐变主题)

#### 后端技术
- **Web框架**: FastAPI 0.x
- **ASGI服务器**: Uvicorn
- **MQTT客户端**: paho-mqtt
- **异步编程**: asyncio
- **数据验证**: Pydantic
- **环境管理**: Conda

#### 数据格式
- **数据源**: 历史气象数据（2014年）
  - `temperature.txt` - 温度数据
  - `humidity.txt` - 湿度数据
  - `pressure.txt` - 气压数据
- **时间跨度**: 2014-02-13 至 2015-01-03
- **数据量**: 约47000+条时间戳对齐的数据

### 核心功能
1. **连接管理**
   - 连接/断开MQTT Broker
   - 连接状态实时显示

2. **传感器配置**
   - 传感器ID配置
   - 位置信息设置
   - 备注信息

3. **批量发布**
   - 从txt文件加载三种传感器数据
   - 按时间戳对齐数据
   - 可配置发布间隔（0.01-10秒）
   - 实时进度条显示
   - 可随时停止发布

4. **实时监控**
   - WebSocket推送发布进度
   - 实时日志显示每条消息详情
   - 已发布数量统计

### API端点
- `GET /` - 服务状态
- `POST /mqtt/connect` - 连接MQTT Broker
- `POST /mqtt/disconnect` - 断开MQTT连接
- `GET /data/info` - 获取数据文件信息
- `POST /publish/start` - 开始批量发布
- `POST /publish/stop` - 停止发布
- `GET /publish/status` - 获取发布状态
- `WS /ws/status` - WebSocket实时状态推送

### 交付内容
- ✅ 发布端Web应用 (前端 + 后端)
- ✅ 统一启动脚本 `start.ps1`
- ✅ 历史气象数据文件
- ✅ 项目文档和README

---


## 🎯 C同学 - 数据处理与分析（待实现）

### 主要任务
订阅MQTT数据，进行本地存储、处理分析，并以图表形式可视化展示。

### 详细功能需求

#### 1. 数据订阅与存储 (必做)
- [ ] 订阅三个传感器主题
- [ ] 将接收的数据存储到本地
- [ ] 存储格式选择：JSON文件

#### 2. 数据统计分析 (必做)
- [ ] **基础统计**:
  - 最大值、最小值、平均值
  - 中位数、标准差
  - 数据总量统计
  
- [ ] **时间序列分析**:
  - 按小时/天/周统计
  - 趋势分析
  - 峰值检测

- [ ] **多维度分析**:
  - 三种数据的相关性分析
  - 异常值检测
  - 数据质量评估

#### 3. 数据可视化 (必做)
使用图表库（推荐ECharts）展示数据分析结果

##### 必做图表：
- [ ] **折线图**: 时间序列数据变化趋势
  - 温度随时间变化曲线
  - 湿度随时间变化曲线
  - 气压随时间变化曲线
  - 支持三条曲线叠加显示

- [ ] **柱状图**: 统计数据对比
  - 每小时平均温度
  - 每日最高/最低值对比

- [ ] **数据卡片**: 实时统计指标
  - 当前值、最大值、最小值、平均值

##### 选做图表：
- [ ] **散点图**: 数据分布和相关性
  - 温度与湿度关系散点图
  - 气压与温度关系散点图

- [ ] **饼图**: 数据分类统计
  - 温度区间分布
  - 异常数据占比

- [ ] **热力图**: 时间-数值热力分布
  - 小时×日期的温度热力图

- [ ] **仪表盘**: 实时数据显示
  - 温度仪表盘
  - 湿度仪表盘

#### 4. 数据查询与筛选 (必做)
- [ ] 时间范围筛选
- [ ] 数据类型筛选
- [ ] 数值范围筛选
- [ ] 查询结果导出

#### 5. 实时监控面板 (必做)
- [ ] 实时接收并显示最新数据
- [ ] 图表实时更新（如最近1小时数据）
- [ ] 异常数据预警（超出正常范围）

#### 6. 历史数据回放 (选做)
- [ ] 选择时间段回放历史数据
- [ ] 回放速度控制
- [ ] 回放时图表动态更新

### 推荐技术栈

#### 前端技术
```
核心框架:
- Vue 3 (Composition API)
- Vite 5.x
- Vue Router 4

图表库:
- ECharts 5.x (推荐) 或
- Chart.js 或
- Apache Superset

MQTT客户端:
- mqtt.js

UI组件:
- Element Plus (提供丰富的表格、表单组件)

时间处理:
- Day.js 或 Moment.js
```

#### 后端技术（推荐方案）
```
Web框架:
- FastAPI (与发布端保持一致)

MQTT客户端:
- paho-mqtt

数据分析:
- Pandas (数据处理)
- NumPy (数值计算)
- Scipy (统计分析)

ORM:
- SQLAlchemy 或 Tortoise ORM
```
---


## 🎯 D同学 - 数据订阅端开发（待实现）

### 主要任务
通过与MQTT Broker连接，实时订阅并显示传感器数据。

### 详细功能需求

#### 1. 连接管理 (必做)
- [ ] 输入MQTT Broker地址和端口
- [ ] 连接/断开功能
- [ ] 连接状态显示（在线/离线）
- [ ] 连接失败错误提示

#### 2. 主题订阅管理 (必做)
- [ ] 订阅三个主题：
  - `sensor/temperature`
  - `sensor/humidity`
  - `sensor/pressure`
- [ ] 支持订阅/取消订阅功能
- [ ] 显示已订阅主题列表
- [ ] QoS级别选择（0, 1, 2）

#### 3. 数据实时显示 (必做)
- [ ] 实时接收并显示最新数据
- [ ] 三种数据分卡片显示：
  - 温度卡片（显示数值、单位、时间戳）
  - 湿度卡片（显示数值、单位、时间戳）
  - 气压卡片（显示数值、单位、时间戳）
- [ ] 数据更新动画效果
- [ ] 数据接收时间显示

#### 4. 消息日志 (必做)
- [ ] 实时消息日志列表
- [ ] 显示内容：时间戳、主题、数值、单位
- [ ] 日志自动滚动到最新
- [ ] 清空日志功能
- [ ] 日志条数限制（如最多500条）

#### 5. 数据统计 (选做)
- [ ] 已接收消息总数
- [ ] 各类型数据接收数量统计
- [ ] 数据接收速率（条/秒）
- [ ] 最后接收时间

#### 6. 数据导出 (选做)
- [ ] 导出接收的数据为CSV文件
- [ ] 导出日志为TXT文件
- [ ] 选择导出时间范围

### 推荐技术栈

#### 前端技术
```
核心框架:
- Vue 3 (Composition API)
- Vite 5.x
- Vue Router 4

MQTT客户端:
- mqtt.js 或 paho-mqtt (JavaScript版本)

UI组件:
- 自定义组件 或
- Element Plus / Ant Design Vue

样式:
- CSS3
- 统一的深色主题（与发布端保持一致）
```

#### 后端

- 使用后端代理
  - FastAPI + paho-mqtt (Python)
  - 前端通过WebSocket与后端通信
  - 后端负责MQTT订阅
  - 适合需要数据处理的场景

### 页面布局建议
```
订阅端页面
├── 顶部状态栏
│   ├── MQTT连接状态
│   ├── 已接收消息数
│   └── 在线时长
│
├── 连接配置面板
│   ├── Broker地址输入
│   ├── 端口输入
│   └── 连接/断开按钮
│
├── 主题订阅管理面板
│   ├── sensor/temperature [✓订阅] [✗取消]
│   ├── sensor/humidity   [✓订阅] [✗取消]
│   └── sensor/pressure   [✓订阅] [✗取消]
│
├── 实时数据显示区域（三列卡片）
│   ├── 温度卡片 [🌡️ 3.0°C | 2014-02-13 06:20:00]
│   ├── 湿度卡片 [💧 93% | 2014-02-13 06:20:00]
│   └── 气压卡片 [🌫️ 989hPa | 2014-02-13 06:20:00]
│
└── 消息日志面板
    ├── [06:20:00] sensor/temperature → 3.0°C
    ├── [06:20:00] sensor/humidity → 93%
    ├── [06:20:00] sensor/pressure → 989hPa
    └── ...
```

### 系统架构建议

```
前端 (Vue3)
    ↓
    ├─→ WebSocket ←→ 后端实时推送
    └─→ REST API ←→ 后端数据查询

后端 (FastAPI)
    ↓
    ├─→ MQTT订阅 ←→ MQTT Broker
    └─→ 数据处理 (Pandas)
```

### 数据流向
```
历史数据文件 → 发布端 → MQTT Broker → 订阅端（实时显示）
                              ↓
                        数据处理端（存储+分析）
```

### MQTT消息格式（统一标准）
```json
{
  "timestamp": "2014-02-13T06:20:00",
  "value": 3.0,
  "unit": "°C"  // 或 "%" 或 "hPa"
}
```